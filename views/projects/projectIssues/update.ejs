<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title><%=title%></title>
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" title="no title">
  <link rel="stylesheet" href="/css/sidebar.css">
  <link rel="stylesheet" href="/css/issue.css">

</head>
<body>

  <div class="container">
    <div class="wrapper">
      <div id="content">
        <nav class="navbar navbar-default">
          <div class="container-fluid">
            <div class="navbar-body">
            </div><!DOCTYPE html>
            <html>
            <head>
              <meta charset="utf-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <meta http-equiv="X-UA-Compatible" content="IE=edge">
              <title><%=title%></title>
              <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" title="no title">
              <link rel="stylesheet" href="/css/sidebar.css">
            </head>
            <body>
              <div class="container">
                <nav class="navbar navbar-default">
                  <div class="container-fluid">
                    <div class="navbar-header">
                      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                      </button>
                      <a class="navbar-brand" href="#">Project Management System</a>
                    </div>
                    <div id="navbar" class="navbar-collapse collapse">
                      <ul class="nav navbar-nav">
                        <li class="<%=(page=='dashboard') ? ' active':''%>"><a href="/dashboard">Home</a></li>
                        <li class="<%=(page=='project') ? ' active':''%>"><a href="/project">Projects</a></li>
                        <li class="<%=(page=='profile') ? ' active':''%>"><a href="/profile">Profile</a></li>
                      </ul>
                      <ul class="nav navbar-nav navbar-right">
                        <li><a href="/logout">Logout</a></li>
                      </ul>
                    </div>
                  </div>
                </nav>

                <% if(page == 'dashboard'){%>
                  <div class="jumbotron">
                    <h1>Project Management System</h1>
                    <p>Manage your system neat and quick</p>
                  </div>

                  <%}%>

                </div>

                <div class="container">

                  <div class="wrapper">
                    <nav id="sidebar">
                      <div class="sidebar-header">
                        <h3>Project Details</h3>
                      </div>

                      <ul class="list-unstyled components">
                        <li>
                          <a href="/project/<%=id%>/overview">Overview</a>
                        </li>
                        <li>
                          <a href="/project/<%=id%>/activity">Activity</a>
                        </li>
                        <li>
                          <a href="/project/<%=id%>/members/">Members</a>
                        </li>
                        <li class="active">
                          <a href="/project/<%=id%>/issues">Issues</a>
                        </li>
                      </ul>
                    </nav>

                    <div id="content">
                      <nav class="navbar navbar-default">
                        <div class="container-fluid">
                          <div class="navbar-body">
                            <h2>Update Issue</h2>
                          </div>
                        </div>
                      </nav>

                      <div class="line"></div>

                      <form class="form-horizontal" method="post" action="/project/<%=id%>/issue/update/<%=issueid%>">
                        <div class="form-group">
                          <label class="control-label col-sm-2" for="pwd">Tracker</label>
                          <div class="col-sm-5">
                            <label class="col-sm-10 radio">
                              <input type="radio" name="tracker" value="Bug" required <%= data[0].tracker == "Bug" ? 'checked':''%>>Bug
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="tracker" value="Feature" required <%= data[0].tracker == "Feature"? 'checked':''%>>Feature
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="tracker" value="Support" required <%= data[0].tracker == "Support"? 'checked':''%>>Support
                            </label>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="subject">Subject</label>
                          <div class="col-sm-5">
                            <input type="text" class="form-control" id="subject" name="subject" placeholder="Subject" value="<%=data[0].subject%>"required>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="description">Description</label>
                          <div class="col-sm-5">
                            <textarea type="text" class="form-control" id="description" name="description" placeholder="Description"required><%=data[0].description%></textarea>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="pwd">Status</label>
                          <div class="col-sm-5">
                            <label class="col-sm-5 radio">
                              <input type="radio" name="status" value="new" required <%= data[0].status == "new"? 'checked':''%>>New
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="status" value="In Progress" required <%= data[0].status == "In Progress"? 'checked':''%>>In Progress
                            </label>
                            <label class="col-sm-5 radio">
                              <input type="radio" name="status" value="Resolved" required <%= data[0].status == "Resolved"? 'checked':''%>>Resolved
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="status" value="Feedback" required <%= data[0].status == "Feedback"? 'checked':''%>>Feedback
                            </label>
                            <label class="col-sm-5 radio">
                              <input type="radio" name="status" value="Closed" required <%= data[0].status == "Closed"? 'checked':''%>>Closed
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="status" value="Rejected" required <%= data[0].status == "Rejected"? 'checked':''%>>Rejected
                            </label>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="pwd">Priority</label>
                          <div class="col-sm-5">
                            <label class="col-sm-5 radio">
                              <input type="radio" name="priority" value="Normal" required <%= data[0].priority == "Normal"? 'checked':''%>>Normal
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="priority" value="High" required <%= data[0].priority == "High"? 'checked':''%>>High
                            </label>
                            <label class="col-sm-5 radio">
                              <input type="radio" name="priority" value="Urgent" required <%= data[0].priority == "Urgent"? 'checked':''%>>Urgent
                            </label>
                            <label class="col-sm-10 radio">
                              <input type="radio" name="priority" value="Immediate" required <%= data[0].priority == "Immediate"? 'checked':''%>>Immediate
                            </label>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="control-label col-sm-2" for="assignee">Assignee</label>
                          <div class="col-sm-5">
                            <select class="form-control" name="assignee" id="assignee" required>
                              <option value="" selected disabled>Choose the member ...</option>
                              <% for(let i=0; i<users.length; i++){ %>
                                <% if(users[i].userid === data[0].assignee){%>
                                  <option selected value = "<%= users[i].userid %>"><%= `${users[i].firstname} ${users[i].lastname}` %></option>
                                <%}else{%>issueid,tracker,subject,description,status,priority,assignee,startdate,duedate,estimatedtime,done,files
                                  <option value = "<%= users[i].userid %>"><%= `${users[i].firstname} ${users[i].lastname}` %></option>
                                <%}%>
                              <% } %>
                            </select>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="startdate">Start Date</label>
                          <div class="col-sm-5">
                            <input type="text" class="form-control" id="startdate" name="startdate" placeholder="Start Date" value="<%=moment(data[0].startdate).format("YYYY-MM-DD")%>" required>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="duedate">Due Date</label>
                          <div class="col-sm-5">
                            <input type="text" class="form-control" id="duedate" name="duedate" placeholder="Due Date" value="<%=moment(data[0].duedate).format("YYYY-MM-DD")%>"required>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="estimatedtime">Estimated Time</label>
                          <div class="col-sm-5">
                            <input type="text" class="form-control" id="estimatedtime" name="estimatedtime" placeholder="Estimated Time" value="<%=data[0].estimatedtime%>"required>
                          </div>
                        </div>

                        <div class="form-group row">
                          <label class="control-label col-sm-2" for="percentdone">% done</label>
                          <div class="col-sm-5">
                            <select class="form-control" name="percentdone" id="percentdone" required>
                              <option value="">Choose progress ...</option>
                              <% for(let i=0;i<=100;i+=25){%>
                                <% if(i === data[0].done){%>
                                  <option selected value = "<%=i%>"><%=i%></option>
                                <%}else {%>
                                  <option value = "<%=i%>"><%=i%></option>
                                <%}%>
                              <%}%>
                            </select>
                          </div>
                        </div>

                        <div class="form-group">
                          <label class="control-label col-sm-2" for="files">Files</label>
                          <div class="col-sm-5">
                              <% if(files){%>
                                <ul class="list-group">
                                <%for(let prop in files){%>
                                  <li class="list-group-item"><%=files[prop]%><br><img src="/issuefile/<%=files[prop]%>" style="border: 1px solid; width:50px; heigth:50px;">&nbsp<a href="/project/<%=id%>/issue/upload/<%=issueid%>/<%=files[prop]%>">&#10006</a></li>
                                <%}%>
                              </ul>
                              <%}else{%>
                                <label class="label label-danger">no files uploaded</label>
                              <%}%>
                          </div>
                        </div>

                        <button class="btn btn-success" type="submit">Save</button>
                      </form>
      <%if(message.length > 0) {%><label class="label label-success"><%=message%></label><%}%>
                    </div>
                  </div>
                </div>

<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="crossorigin="anonymous"></script>
<script type="text/javascript" src="/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/js/sidebar.js"></script>
</body>
</html>
